---
import { Image } from "astro:assets";
import BaseLayout from "@layouts/BaseLayout.astro";
import NavWrapper from "@components/NavigationWrapper.astro";
import Giscus from "@components/Giscus.astro";

const { frontmatter } = Astro.props;
const pubDate = new Date(frontmatter.pubDate);
const formattedPubDate = Number.isNaN(pubDate.valueOf())
  ? String(frontmatter.pubDate)
  : pubDate.toLocaleDateString("ko-KR", {
      year: "numeric",
      month: "long",
      day: "numeric",
      timeZone: "Asia/Seoul",
    });
const tags = Array.isArray(frontmatter.tags) ? frontmatter.tags : [];
---

<BaseLayout
  pageTitle={frontmatter.title}
  description={frontmatter.description}
  ogType="article"
>
  <header>
    <NavWrapper />
  </header>
  <hr />
  <main>
    <div class="container">
      {
        frontmatter.image.url.length >= 2 ? (
          <section>
            <Image
              src={frontmatter.image.url}
              alt={frontmatter.image.alt}
              inferSize
            />
          </section>
        ) : null
      }
      <section>
        <hgroup>
          <h1>{frontmatter.title}</h1>
          <p class="post-description">{frontmatter.description}</p>
          {tags.length > 0 ? (
            <p class="post-tags">
              [ {tags.map((tag: string, index: number) => (
                <>
                  <a href={`/tags/${encodeURIComponent(tag)}/`}>
                    {tag}
                  </a>
                  {index < tags.length - 1 ? ', ' : ''}
                </>
              ))} ]
            </p>
          ) : null}
          <p>{formattedPubDate}</p>
          <!-- <p>Written by: <a href="/about/">{frontmatter.author}</a></p> -->
        </hgroup>
      </section>
      <hr />
      <section>
        <slot />
      </section>
      <hr />
      <section>
        <Giscus />
      </section>
      <hr />
    </div>
  </main>
</BaseLayout>

<style>
  hgroup h1 {
    margin-bottom: 1rem;
  }

  hgroup p {
    margin-bottom: 0.75rem;
  }

  .post-description {
    color: var(--color-text-muted);
    font-weight: 500;
    margin-bottom: 0.75rem;
  }

  .post-tags {
    margin: 0;
    color: var(--pico-muted-color);
  }

  .post-tags a {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background-color: var(--color-tag-alt-bg);
    color: var(--color-tag-alt-text);
    text-decoration: none;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-weight: 500;
    transition: background-color 0.2s ease, color 0.2s ease,
      transform 0.2s ease;
  }

  .post-tags a:hover {
    background-color: var(--color-tag-alt-hover-bg);
    color: var(--color-tag-alt-hover-text);
    transform: translateY(-1px);
  }
</style>
